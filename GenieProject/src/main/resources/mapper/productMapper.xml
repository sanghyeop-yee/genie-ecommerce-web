<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.genie.myapp.dao.ProductDAO">
    <select id="product" resultType="ProductVO">

        select 
            product_id, 
            genie_id,
            product_category,
            product_tag,
            product_name,
            product_price,
            product_info,
            product_stock,
            product_quantity,
            product_hit,
            product_like,
            product_writedate,
            product_image1,
            product_image2,
            product_image3,
            product_mbti
        from product 
        where product_category like '%${product_category}%'  <!--where procuct_category like '%생일%'-->
        order by product_id desc

    </select>

    <select id = "getProduct" resultType = "ProductVO" parameterType = "int">

        select
	  		product_id, 
            genie_id,
            product_category,
            product_tag,
            product_name,
            product_price,
            product_info,
            product_stock,
            product_quantity,
            product_hit,
            product_like,
            product_writedate,
            product_image1,
            product_image2,
            product_image3,
            product_mbti 
        from product 
        where product_id=#{product_id} 

	</select>

    <select id="getSeller" resultType="SellerVO">

        select 
            s.genie_id, 
            seller_tel, 
            seller_email, 
            seller_reg_no, 
            company_name, 
            ceo_name, 
            seller_website,
            seller_address 
        from seller s
        join product p
        on s.genie_id=p.genie_id
        where p.product_id=#{product_id}

    </select>

    <select id="getCart" resultType="CartVO">

        select 
            p.product_id, 
            p.genie_id,
            p.product_category,
            p.product_tag,
            p.product_name,
            p.product_price,
            p.product_info,
            p.product_stock,
            p.product_quantity,
            p.product_hit,
            p.product_like,
            p.product_writedate,
            p.product_image1,
            p.product_image2,
            p.product_image3,
            p.product_mbti  
        from product p 
        join cart c  
        on c.product_id = p.product_id 
        where c.genie_id=#{genie_id}

    </select>

    <insert id="addCart" parameterType="CartVO">

        insert into Cart(cart_num, genie_id, product_id, cart_price, cart_qty) 
        values(#{cart_num}, #{genie_id}, #{product_id}, #{cart_price}, #{cart_qty})

    </insert>

    <select id = "selectProduct" resultType="ProductVO">

        select 
            product_id, 
            genie_id,
            product_category,
            product_tag,
            product_name,
            product_price,
            product_info,
            product_stock,
            product_quantity,
            product_hit,
            product_like,
            product_writedate,
            product_image1,
            product_image2,
            product_image3,
            product_mbti 
        from product 
        <where>
        <if test = "p.product_category != null">
            product_category like '%${p.product_category}%'
        </if>
        <if test = "p.product_category != null and t.genie_who != null">
            and
        </if>
        <if test = "t.genie_who != null">
            product_tag like '%${t.genie_who}%' and  
            product_tag like '%${t.genie_day}%' and  
            product_tag like '%${t.genie_old}%' and  
            product_tag like '%${t.gender}%' 
        </if>
        and product_price between #{t.money_low} and #{t.money_max} 
        </where>
        order by rand()

    </select>


</mapper>